name: Foundry CI

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # ðŸ§± Install Foundry (run foundryup directly by path)
      - name: Install Foundry
        run: |
          curl -L https://foundry.paradigm.xyz | bash
          bash -i -c "~/.foundry/bin/foundryup"
          echo "$HOME/.foundry/bin" >> $GITHUB_PATH

      - name: Verify Foundry
        run: |
          ~/.foundry/bin/forge --version
          ~/.foundry/bin/cast --version

      - name: Install dependencies
        run: |
          ~/.foundry/bin/forge install foundry-rs/forge-std --no-commit
          ~/.foundry/bin/forge install smartcontractkit/chainlink-brownie-contracts --no-commit
          ~/.foundry/bin/forge install Cyfrin/foundry-devops --no-commit

      - name: Build and Test
        run: |
          ~/.foundry/bin/forge build --sizes
          ~/.foundry/bin/forge test -vvv
